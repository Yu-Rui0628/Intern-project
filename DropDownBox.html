<!DOCTYPE html>
<html>
  <head>
    <title>Login</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.css"
    />
    <style>
      #week-calendarid,
      #daily-calendarID {
        display: none;
      }
    </style>
  </head>
  <body>
    <style>
      /* @media (min-width: 769px) {
        body {
          background-color: white;
          font-family: "Times New Roman", serif;
        }

        .btn-primary,
        .form-control,
        .form-group label {
          border-radius: 5px;
          border: 1px solid #96c8a2;
          background-color: #e6f2df;
          color: #5c865c;
        }

        .btn-primary:hover {
          background-color: #cde4c3;
          color: #3b543b;
        }

        #calendar th {
          background-color: #b4d3b2;
          color: #3e533e;
        }

        #calendar .today {
          background-color: #cde4c3;
        }

        .modal-content {
          background-color: #f8faf5;
          border-color: #b4d3b2;
        }

        .close {
          color: #aab3a1;
        }

        .close:hover,
        .close:focus {
          color: #687568;
        }

        .loading {
          border-top-color: #96c8a2;
        }

        .calendar-nav button {
          background-color: #e6f2df;
          color: #5c865c;
        }

        .calendar-nav button:hover {
          background-color: #cde4c3;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .row {
          margin-right: 0;
          margin-left: 0;
        }
        #Carer_id,
        #Customer_id,
        #Calendar_id {
          font-size: 1.1rem; 
          font-weight: bold; 
          color: #333; 
          padding: 10px 0;
          margin-bottom: 10px; 
          text-transform: uppercase;
          display: block;
          background-color: transparent; 
          border-radius: 0;
          color: #4ad09b;
          border: none;
        }

        #carer-dropdown,
        #customer-dropdown,
        #calendar-dropdown {
          margin-top: 15px; 
          margin-left: 5px;
          width: 70%; 
          height: 50%; 
          box-sizing: border-box;
          border: 2px solid #4ad09b; 
          border-radius: 5px;
          padding: 5px; 
          background-color: #fff; 
          box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1); 
          color: #333; 
          font-size: 1rem; 
        }

        #carer-dropdown:hover,
        #customer-dropdown:hover,
        #calendar-dropdown:hover {
          border-color: #369f8c; 
        }

        .Filtercontainer {
          display: flex;
          flex-direction: column;
          justify-content: center;
          background-color: white;
          border-radius: 25px;
          height: 100%;
          width: 100%;
          margin: 0 auto;
          position: relative;
          box-shadow: 0 4px 8px rgba(74, 208, 155, 0.5); 
          padding: 20px; 
        }
        #calendar ul {
          list-style-type: none;
          padding-left: 0;
        }

        #calendar li {
          margin-left: 15px;
          position: relative;
          cursor: pointer;
        }

        #calendar li::before {
          content: "•";
          position: absolute;
          left: -15px;
          top: 50%;
          transform: translateY(-50%);
          font-size: 2em;
        }

        .color-0::before {
          color: red;
        }
        .color-1::before {
          color: blue;
        }
        .color-2::before {
          color: green;
        }
        .color-3::before {
          color: orange;
        }
        .color-4::before {
          color: purple;
        }
        .color-5::before {
          color: yellow;
        }

        .vertical-center {
          padding: 10vh 0;
          display: flex;
          align-items: center;
        }

        body {
          font-family: "Trebuchet MS", sans-serif;
        }

        #calendar {
          border-collapse: collapse;
          height: 50%;
          width: 90%;
          margin: auto;
          padding: 0 5%;
          background-color: #4ad09b;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
          border-radius: 15px;
        }

        #calendar th {
          background-color: #4ad09b;
          color: white;
          padding: 10px;
          border-radius: 15px;
        }

        #calendar td {
          border: 1px solid #d3d3d3;
          background-color: white;
          padding: 10px;
          text-align: left;
          vertical-align: top;
         
          width: 14%;
          height: 120px;

          overflow: auto;
          word-break: break-word;
          font-size: 50%;
      
          box-sizing: border-box;
        }

        #calendar .today {
          background-color: #a8dbd9;
          border-radius: 10px;
        }
        .calendar-nav {
          padding: 10px;
          text-align: center;
          margin-bottom: 10px;
        }

        .calendar-nav button {
          background-color: white;
          color: #4ad09b;
          border: 2px solid #4ad09b;
          border-radius: 15px;
          padding: 10px 20px;
          margin: 0 10px;
        }

        .calendar-nav button:hover {
          background-color: #a8dbd9;
          color: white;
        }

        #monthYear {
          font-weight: bold;
        }
        .mark-text {
          font-weight: bold;
          color: red;
        }

        .today {
          background-color: blue;
        }

        .loading {
          border: 5px solid #f3f3f3;
          border-top: 5px solid #3498db;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          animation: spin 2s linear infinite;
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          display: block;
        }

        @keyframes spin {
          0% {
            transform: translate(-50%, -50%) rotate(0deg);
          }
          100% {
            transform: translate(-50%, -50%) rotate(360deg);
          }
        }
        .calendar-container {
          margin-top: 0px;
        }

        .modal {
          display: none;
          position: fixed;
          z-index: 1;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          overflow: auto;
          background-color: rgb(77, 174, 116);
          background-color: rgba(0, 0, 0, 0.4);
        }

        #modalButtons {
          width: 100%;
          display: flex;
          justify-content: space-around;
          padding-top: 20px;
        }

        .modal-content {
          background-color: #fefefe;
          margin: 10% auto;
          padding: 20px;
          border: 1px solid #888;
          width: 30%;
          border-radius: 10px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
          position: relative;
          display: flex;
          flex-direction: column;
          align-items: center;
        }

        .modal-content h2 {
          color: #333333;
          margin-bottom: 15px;
        }

        .modal-content p {
          color: #555555;
          line-height: 1.6;
        }

        .modal-content .btn {
          border-radius: 20px;
          padding: 10px 15px;
          margin-top: 15px;
        }

        .modal-content .close {
          color: #aaaaaa;
          text-shadow: none;
          opacity: 0.5;
        }

        .modal-content .close:hover {
          opacity: 1;
        }

        .close {
          position: absolute;
          right: 40px;
          top: 10px;

          color: #aaa;
          float: right;
          font-size: 28px;
          font-weight: bold;
        }

        .close:hover,
        .close:focus {
          color: black;
          text-decoration: none;
          cursor: pointer;
        }

        #Start_End_time {
          margin-top: 20px;
        }

        .modal-content .btn {
          border: none;
          padding: 10px 20px;
          margin: 10px 5px 0;
          border-radius: 5px;
          font-weight: bold;
          transition: all 0.3s ease;
          box-shadow: 0 2px 2px rgba(0, 0, 0, 0.2);
        }

        #editButton {
          border: none;
          width: 60px;
          height: 30px;
          border-radius: 5px;
          background-color: #4caf50;
          color: white;
        }

        #editButton:hover {
          background-color: #369f8c;
        }

        #deleteButton {
          border: none;
          width: 60px;
          height: 30px;
          border-radius: 5px;
          background-color: #f44336;
          color: white;
        }

        #deleteButton:hover {
          background-color: #da190b;
        }
        #updateButton {
          border: none;
          width: 200px;
          height: 30px;
          border-radius: 5px;
          background-color: #4caf50;
          color: white;
        }
        #updateButton:hover {
          background-color: #369f8c;
        }



        .edit-schedule-popup {
          display: none;
          position: fixed;
          z-index: 1000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          overflow: auto;
          background-color: rgba(0, 0, 0, 0.6);
        }

        .popup-content {
          display: flex;
          flex-direction: column;
          align-items: center;
          background-color: #fff;
          margin: 10% auto;
          padding: 20px;
          border-radius: 10px;
          box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
          width: 30%;
          min-width: 300px;
        }

        .close-popup {
          align-self: flex-end;
          color: #333;
          float: right;
          font-size: 28px;
          font-weight: bold;
        }

        .close-popup:hover,
        .close-popup:focus {
          color: #000;
          text-decoration: none;
          cursor: pointer;
        }

        label {
          display: block;
          margin: 10px 0 5px;
          color: #333;
          font-size: 14px;
        }

        input[type="datetime-local"],
        input[type="text"],
        input[type="search"],
        select {
          width: 100%;
          padding: 8px;
          margin: 5px 0 20px;
          display: inline-block;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;
        }

        button[type="submit"] {
          width: 100%;
          background-color: #4caf50;
          color: white;
          padding: 14px 20px;
          margin: 8px 0;
          border: none;
          border-radius: 4px;
          cursor: pointer;
        }

        button[type="submit"]:hover {
          background-color: #45a049;
        }

        @media screen and (max-width: 600px) {
          .popup-content {
            width: 80%;
          }
        }

        #Addexpense {
          width: 100%;
          height: 100px;
          padding: 8px;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;
          resize: vertical;
        }

        .week-calendar-container {
          overflow-x: auto;
        }

        .week-calendar-nav {
          margin-top: 10px;
          text-align: center;
          margin-bottom: 10px;
        }

        #week-calendar {
          border-collapse: separate;
          border-spacing: 10px;
          width: 90%;
          margin: auto;
          padding: 0 5%;
          background-color: #4ad09b;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
          border-radius: 15px;
        }

        #week-calendar th {
          font-size: 12px;
          background-color: #4ad09b;
          color: white;
          padding: 10px;
          border-radius: 15px;
        }

        #week-calendar td {
          background-color: white;
          padding: 10px;
          text-align: left;
          vertical-align: top;
          width: 11%;
          height: 120px;
          min-width: 100px;
          overflow: auto;
          word-break: break-word;
          font-size: 10px;

          box-sizing: border-box;
        }

        .text-cell {
          width: 100%;
          height: 100px;
          overflow-y: auto;
        }
 
        .event-tip {
          display: block;
          cursor: pointer;
          width: auto;
          height: 30px;
          margin-bottom: 5px;
        }

        .week-calendar-button {
          margin-top: 3px;
          background-color: white;
          color: #4ad09b;
          border: 2px solid #4ad09b;
          border-radius: 15px;
          padding: 10px 20px;
          margin: 0 10px;
        }

        .week-calendar-button:hover {
          background-color: #a8dbd9;
          color: white;
        }



        .daily-calendar {
          border-collapse: separate;
          border-spacing: 10px;
          width: 90%;
          margin: auto;
          padding: 0 5%;


          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);

          height: 100vh;
          overflow-y: auto;
        }

        .daily-calendar-body {
          display: grid;
          grid-gap: 0.5rem;
          height: 100%;
          border-top: solid #ddd;

          grid-template-columns: 8rem repeat(100, 1fr);
          grid-template-rows: repeat(30, 1fr);
          grid-template-areas:
            "time6 stage"
            "time7 stage"
            "time8 stage"
            "time9 stage"
            "time10 stage"
            "time11 stage"
            "time12 stage"
            "time13 stage"
            "time14 stage"
            "time15 stage"
            "time16 stage"
            "time17 stage"
            "time18 stage"
            "time19 stage"
            "time20 stage"
            "time21 stage";
        }

        .time {
          display: flex;
          align-items: center;
          justify-content: center;
          height: 50px;

          background-color: white;
          border-bottom-style: solid;
          border-color: #ddd;
        }

        .dailyevent {
          display: flex;
          justify-content: center;
          flex-direction: column;
          padding: 0.5rem 1rem;
          background-color: orange;
          border-radius: 0.2rem;
          font-size: 0.8rem;
          font-weight: bold;
          line-height: 1.4;
          border-top: black;
          width: 100px;
        }

        .dailyevent p {
          width: 100%;
          font-size: 0.8em;
          font-weight: normal;
          margin: 2%;
        }

        .dailyevent.start-6 {
          grid-row-start: time6;
        }
        .dailyevent.start-7 {
          grid-row-start: time7;
        }
        .dailyevent.start-8 {
          grid-row-start: time8;
        }
        .dailyevent.start-9 {
          grid-row-start: time9;
        }
        .dailyevent.start-10 {
          grid-row-start: time10;
        }
        .dailyevent.start-11 {
          grid-row-start: time11;
        }
        .dailyevent.start-12 {
          grid-row-start: time12;
        }
        .dailyevent.start-13 {
          grid-row-start: time13;
        }
        .dailyevent.start-14 {
          grid-row-start: time14;
        }
        .dailyevent.start-15 {
          grid-row-start: time15;
        }
        .dailyevent.start-16 {
          grid-row-start: time16;
        }
        .dailyevent.start-17 {
          grid-row-start: time17;
        }
        .dailyevent.start-18 {
          grid-row-start: time18;
        }
        .dailyevent.start-19 {
          grid-row-start: time19;
        }
        .dailyevent.start-20 {
          grid-row-start: time20;
        }

        .dailyevent.end-7 {
          grid-row-start: time7;
        }
        .dailyevent.end-8 {
          grid-row-end: time8;
        }
        .dailyevent.end-9 {
          grid-row-end: time9;
        }
        .dailyevent.end-10 {
          grid-row-end: time10;
        }
        .dailyevent.end-11 {
          grid-row-end: time11;
        }
        .dailyevent.end-12 {
          grid-row-end: time12;
        }
        .dailyevent.end-13 {
          grid-row-end: time13;
        }
        .dailyevent.end-14 {
          grid-row-end: time14;
        }
        .dailyevent.end-15 {
          grid-row-end: time15;
        }
        .dailyevent.end-16 {
          grid-row-end: time16;
        }
        .dailyevent.end-17 {
          grid-row-end: time17;
        }
        .dailyevent.end-18 {
          grid-row-end: time18;
        }
        .dailyevent.end-19 {
          grid-row-end: time19;
        }
        .dailyevent.end-20 {
          grid-row-end: time20;
        }
        .dailyevent.end-21 {
          grid-row-end: time21;
        }

        .dailyevent.color-0 {
          background-color: #ffa726;
        }
        .dailyevent.color-1 {
          background-color: #9ccc65;
        }
        .dailyevent.color-2 {
          background-color: #ff8a65;
        }
        .dailyevent.color-3 {
          background-color: #b3e5fc;
        }
        .dailyevent.color-4 {
          background-color: #81d4fa;
        }
        .dailyevent.color-5 {
          background-color: #26c6da;
        }

        #DateBox {
          display: flex;
          background-color: #f5f5f5;
          height: 42px;
          font-size: 20px;
          text-size-adjust: 100%;
          align-items: center;
          font-weight: 400;
          justify-content: center;
        }
      } */

      @media (max-width: 768px) {
        body {
          background-color: white;
          font-family: "Times New Roman", serif;
        }

        .btn-primary,
        .form-control,
        .form-group label {
          border-radius: 5px;
          border: 1px solid #96c8a2;
          background-color: #e6f2df;
          color: #5c865c;
        }

        .btn-primary:hover {
          background-color: #cde4c3;
          color: #3b543b;
        }

        #calendar th {
          background-color: #b4d3b2;
          color: #3e533e;
        }

        #calendar .today {
          background-color: #cde4c3;
        }

        .modal-content {
          background-color: #f8faf5;
          border-color: #b4d3b2;
        }

        .close {
          color: #aab3a1;
        }

        .close:hover,
        .close:focus {
          color: #687568;
        }

        .loading {
          border-top-color: #96c8a2;
        }

        .calendar-nav button {
          background-color: #e6f2df;
          color: #5c865c;
        }

        .calendar-nav button:hover {
          background-color: #cde4c3;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .row {
          margin-right: 0;
          margin-left: 0;
        }
        #Carer_id,
        #Customer_id,
        #Calendar_id {
          font-size: 0.9rem; /* Retain font size for visibility */
          font-weight: bold; /* Keep bold for emphasis */
          color: #333; /* Dark color for readability */
          padding: 10px 0; /* Vertical padding for spacing, remove horizontal padding */
          margin-bottom: 10px; /* Adjust bottom margin for better alignment */
          text-transform: uppercase; /* Keep uppercase for stylistic choice */
          display: block; /* Keep block for proper layout */
          background-color: transparent; /* Remove background color */
          border-radius: 0; /* Remove border radius */
          color: #4ad09b; /* Use the theme color for the text */
          border: none;
        }

        
        #customer-dropdown,
        #calendar-dropdown {
        
          margin-top: 15px; /* Adjusted margin-top for better spacing */
          margin-left: 5px;
          width: 70%; /* Increase width for better usability */
          height: 50%; /* Increase height for better visibility and click area */
          box-sizing: border-box;
          border: 2px solid #4ad09b; /* Add border to match the theme */
          border-radius: 5px; /* Rounded corners for dropdown */
          padding: 5px; /* Inner padding for aesthetics */
          background-color: #fff; /* Background color for dropdown */
          box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1); /* Add subtle shadow for depth */
          color: #333; /* Text color for readability */
          font-size: 1rem; /* Adjust font size for better readability */
        }

        #carer-dropdown{

            margin-top: 15px; /* Adjusted margin-top for better spacing */
          margin-left: 31px;
          width: 70%; /* Increase width for better usability */
          height: 50%; /* Increase height for better visibility and click area */
          box-sizing: border-box;
          border: 2px solid #4ad09b; /* Add border to match the theme */
          border-radius: 5px; /* Rounded corners for dropdown */
          padding: 5px; /* Inner padding for aesthetics */
          background-color: #fff; /* Background color for dropdown */
          box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1); /* Add subtle shadow for depth */
          color: #333; /* Text color for readability */
          font-size: 1rem; /* Adjust font size for better readability */

        }

        #carer-dropdown:hover,
        #customer-dropdown:hover,
        #calendar-dropdown:hover {
          border-color: #369f8c; /* Slightly darker border on hover for feedback */
        }

        .Filtercontainer {
          display: flex;
          flex-direction: column;
          justify-content: center;
          background-color: white;
          border-radius: 25px;
          height: 100%;
          width: 100%;
          margin: 0 auto;
          position: relative;
          box-shadow: 0 4px 8px rgba(74, 208, 155, 0.5); /* Shadow color updated to #4AD09B with opacity */
          padding: 20px; /* Add padding */
        }
        #calendar ul {
          list-style-type: none;
          padding-left: 0;
        }

        #calendar li {
          margin-left: 1px;
          position: relative;
          cursor: pointer;
        }

        #calendar li::before {
          content: "•";
          position: absolute;
          left: -3px;
          top: 50%;
          transform: translateY(-50%);
          font-size: 1em;
        }

        .color-0::before {
          color: red;
        }
        .color-1::before {
          color: blue;
        }
        .color-2::before {
          color: green;
        }
        .color-3::before {
          color: orange;
        }
        .color-4::before {
          color: purple;
        }
        .color-5::before {
          color: yellow;
        }

        .vertical-center {
          padding: 10vh 0;
          display: flex;
          align-items: center;
        }

        body {
          font-family: "Trebuchet MS", sans-serif;
        }

        #calendar {
          border-collapse: collapse;
          height: 50%;
          width: 98%;
          margin: auto;
          padding: 0 5%;
          background-color: #4ad09b;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
          border-radius: 15px;
        }

        #calendar th {
          background-color: #4ad09b;
          color: white;
          padding: 10px;
          border-radius: 15px;
          font-size:50%;
        }

        #calendar td {
          border: 1px solid #d3d3d3;
          background-color: white;
          padding: 10px;
          text-align: left;
          vertical-align: top;
          /* width: 110px;
                    height: 120px; */
          width: 100px;
          height: 60px;

          overflow: auto;
          word-break: break-word;
          font-size: 4px;
          /* border-radius: 10px; */
          box-sizing: border-box;
        }

        #calendar .today {
          background-color: #a8dbd9;
          border-radius: 10px;
        }
        .calendar-nav {
          padding: 10px;
          text-align: center;
          margin-bottom: 10px;
        }

        .calendar-nav button {
          background-color: white;
          color: #4ad09b;
          border: 2px solid #4ad09b;
          border-radius: 15px;
          padding: 10px 20px;
          margin: 0 10px;
        }

        .calendar-nav button:hover {
          background-color: #a8dbd9;
          color: white;
        }

        #monthYear {
          font-weight: bold;
        }
        .mark-text {
          font-weight: bold;
          color: red;
        }

        .today {
          background-color: blue;
        }

        .loading {
          border: 5px solid #f3f3f3;
          border-top: 5px solid #3498db;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          animation: spin 2s linear infinite;
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          display: block;
        }

        @keyframes spin {
          0% {
            transform: translate(-50%, -50%) rotate(0deg);
          }
          100% {
            transform: translate(-50%, -50%) rotate(360deg);
          }
        }
        .calendar-container {
          margin-top: 0px;
        }

        .modal {
          display: none;
          position: fixed;
          z-index: 1;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          overflow: auto;
          background-color: rgb(77, 174, 116);
          background-color: rgba(0, 0, 0, 0.4);
        }

        #modalButtons {
          width: 100%;
          display: flex;
          justify-content: space-around;
          padding-top: 20px;
        }

        .modal-content {
          background-color: #fefefe;
          margin: 10% auto;
          padding: 20px;
          border: 1px solid #888;
          width: 30%;
          border-radius: 10px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
          position: relative;
          display: flex;
          flex-direction: column;
          align-items: center;
        }

        .modal-content h2 {
          color: #333333;
          margin-bottom: 15px;
        }

        .modal-content p {
          color: #555555;
          line-height: 1.6;
        }

        .modal-content .btn {
          border-radius: 20px;
          padding: 10px 15px;
          margin-top: 15px;
        }

        .modal-content .close {
          color: #aaaaaa;
          text-shadow: none;
          opacity: 0.5;
        }

        .modal-content .close:hover {
          opacity: 1;
        }

        .close {
          position: absolute;
          right: 40px;
          top: 10px;

          color: #aaa;
          float: right;
          font-size: 28px;
          font-weight: bold;
        }

        .close:hover,
        .close:focus {
          color: black;
          text-decoration: none;
          cursor: pointer;
        }

        #Start_End_time {
          margin-top: 20px;
        }

        .modal-content .btn {
          border: none;
          padding: 10px 20px;
          margin: 10px 5px 0;
          border-radius: 5px;
          font-weight: bold;
          transition: all 0.3s ease;
          box-shadow: 0 2px 2px rgba(0, 0, 0, 0.2);
        }

        #editButton {
          border: none;
          width: 60px;
          height: 30px;
          border-radius: 5px;
          background-color: #4caf50;
          color: white;
        }

        #editButton:hover {
          background-color: #369f8c;
        }

        #deleteButton {
          border: none;
          width: 60px;
          height: 30px;
          border-radius: 5px;
          background-color: #f44336;
          color: white;
        }

        #deleteButton:hover {
          background-color: #da190b;
        }
        #updateButton {
          border: none;
          width: 200px;
          height: 30px;
          border-radius: 5px;
          background-color: #4caf50;
          color: white;
        }
        #updateButton:hover {
          background-color: #369f8c;
        }

        /* Another one */

        .edit-schedule-popup {
          display: none;
          position: fixed;
          z-index: 1000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          overflow: auto;
          background-color: rgba(0, 0, 0, 0.6);
        }

        .popup-content {
          display: flex;
          flex-direction: column;
          align-items: center;
          background-color: #fff;
          margin: 10% auto;
          padding: 20px;
          border-radius: 10px;
          box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
          width: 30%;
          min-width: 300px;
        }

        .close-popup {
          align-self: flex-end;
          color: #333;
          float: right;
          font-size: 28px;
          font-weight: bold;
        }

        .close-popup:hover,
        .close-popup:focus {
          color: #000;
          text-decoration: none;
          cursor: pointer;
        }

        label {
          display: block;
          margin: 10px 0 5px;
          color: #333;
          font-size: 14px;
        }

        input[type="datetime-local"],
        input[type="text"],
        input[type="search"],
        select {
          width: 100%;
          padding: 8px;
          margin: 5px 0 20px;
          display: inline-block;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;
        }

        button[type="submit"] {
          width: 100%;
          background-color: #4caf50;
          color: white;
          padding: 14px 20px;
          margin: 8px 0;
          border: none;
          border-radius: 4px;
          cursor: pointer;
        }

        button[type="submit"]:hover {
          background-color: #45a049;
        }

        @media screen and (max-width: 600px) {
          .popup-content {
            width: 80%;
          }
        }

        #Addexpense {
          width: 100%;
          height: 100px;
          padding: 8px;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;
          resize: vertical;
        }

        .week-calendar-container {
          overflow-x: auto;
        }

        .week-calendar-nav {
          margin-top: 10px;
          text-align: center;
          margin-bottom: 10px;
        }

        #week-calendar {
          border-collapse: collapse;
          border-spacing: 10px;
          width: 90%;
          margin: auto;
          padding: 0 5%;
          background-color: #4ad09b;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
          border-radius: 15px;
        }

        #week-calendar th {
          font-size: 10px;
          background-color: #4ad09b;
          color: white;
          padding: 10px;
          border-radius: 15px;
        }

        #week-calendar td {
          border: 1px solid #d3d3d3;
          background-color: white;
          padding: 10px;
          text-align: left;
          vertical-align: top;
          width: 11%;
          height: 60px;
          min-width: 100px;
          overflow: auto;
          word-break: break-word;
          font-size: 10px;
          /* border-radius: 10px; */
          box-sizing: border-box;
        }

        .text-cell {
          width: 100%;
          height: 100px;
          overflow-y: auto;
        }

        .event-tip {
          display: block;
          cursor: pointer;
          width: auto;
          height: 30px;
          margin-bottom: 5px;
        }

        .week-calendar-button {
          margin-top: 3px;
          background-color: white;
          color: #4ad09b;
          border: 2px solid #4ad09b;
          border-radius: 15px;
          padding: 10px 20px;
          margin: 0 10px;
        }

        .week-calendar-button:hover {
          background-color: #a8dbd9;
          color: white;
        }

        /* daily calendar */

        .daily-calendar {
          border-collapse: separate;
          border-spacing: 10px;
          width: 90%;
          margin: auto;
          padding: 0 5%;
          /* background-color: white; */

          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
          /* border-radius: 15px; */
          height: 100vh;
          overflow-y: auto;
        }

        .daily-calendar-body {
          display: grid;
          grid-gap: 0.5rem;
          height: 100%;
          border-top: solid #ddd;

          grid-template-columns: 50px repeat(100, 1fr);
          grid-template-rows: repeat(30, 1fr);
          grid-template-areas:
            "time6 stage"
            "time7 stage"
            "time8 stage"
            "time9 stage"
            "time10 stage"
            "time11 stage"
            "time12 stage"
            "time13 stage"
            "time14 stage"
            "time15 stage"
            "time16 stage"
            "time17 stage"
            "time18 stage"
            "time19 stage"
            "time20 stage"
            "time21 stage";
        }

        .time {
          display: flex;
          align-items: center;
          justify-content: center;
          height: 50px;
          background-color: white;
          border-bottom-style: solid;
          border-color: #ddd;
        }

        .dailyevent {
          display: flex;
          justify-content: center;
          flex-direction: column;
          align-items: center;
          text-align: center;
          width: 70px;
          border-radius: 0.2rem;
          font-size: 0.8rem;
          font-weight: bold;
          line-height: 1.4;
          border-top: black;
        }

        .dailyevent p {
          width: 100%;
          font-size: 0.8em;
          font-weight: normal;
          text-align: center;
          margin: 2%;
        }

        .dailyevent.start-6 {
          grid-row-start: time6;
        }
        .dailyevent.start-7 {
          grid-row-start: time7;
        }
        .dailyevent.start-8 {
          grid-row-start: time8;
        }
        .dailyevent.start-9 {
          grid-row-start: time9;
        }
        .dailyevent.start-10 {
          grid-row-start: time10;
        }
        .dailyevent.start-11 {
          grid-row-start: time11;
        }
        .dailyevent.start-12 {
          grid-row-start: time12;
        }
        .dailyevent.start-13 {
          grid-row-start: time13;
        }
        .dailyevent.start-14 {
          grid-row-start: time14;
        }
        .dailyevent.start-15 {
          grid-row-start: time15;
        }
        .dailyevent.start-16 {
          grid-row-start: time16;
        }
        .dailyevent.start-17 {
          grid-row-start: time17;
        }
        .dailyevent.start-18 {
          grid-row-start: time18;
        }
        .dailyevent.start-19 {
          grid-row-start: time19;
        }
        .dailyevent.start-20 {
          grid-row-start: time20;
        }

        .dailyevent.end-7 {
          grid-row-start: time7;
        }
        .dailyevent.end-8 {
          grid-row-end: time8;
        }
        .dailyevent.end-9 {
          grid-row-end: time9;
        }
        .dailyevent.end-10 {
          grid-row-end: time10;
        }
        .dailyevent.end-11 {
          grid-row-end: time11;
        }
        .dailyevent.end-12 {
          grid-row-end: time12;
        }
        .dailyevent.end-13 {
          grid-row-end: time13;
        }
        .dailyevent.end-14 {
          grid-row-end: time14;
        }
        .dailyevent.end-15 {
          grid-row-end: time15;
        }
        .dailyevent.end-16 {
          grid-row-end: time16;
        }
        .dailyevent.end-17 {
          grid-row-end: time17;
        }
        .dailyevent.end-18 {
          grid-row-end: time18;
        }
        .dailyevent.end-19 {
          grid-row-end: time19;
        }
        .dailyevent.end-20 {
          grid-row-end: time20;
        }
        .dailyevent.end-21 {
          grid-row-end: time21;
        }

        .dailyevent.color-0 {
          background-color: #ffa726;
        }
        .dailyevent.color-1 {
          background-color: #9ccc65;
        }
        .dailyevent.color-2 {
          background-color: #ff8a65;
        }
        .dailyevent.color-3 {
          background-color: #b3e5fc;
        }
        .dailyevent.color-4 {
          background-color: #81d4fa;
        }
        .dailyevent.color-5 {
          background-color: #26c6da;
        }

        #DateBox {
          display: flex;
          background-color: #4ad09b;
          height: 42px;
          font-size: 20px;
          text-size-adjust: 100%;
          align-items: center;
          font-weight: 400;
          justify-content: center;
        }
      }
    </style>

    <div class="Filtercontainer">
      <div class="row justify-content-center">
        <!-- Carer Selection -->
        <div class="col-md-auto form-group mb-3 d-flex align-items-center">
          <label for="carer-dropdown" id="Carer_id">Carer </label>
          <select id="carer-dropdown" class="form-control">
            <!-- Options here -->
          </select>
        </div>
        <!-- Customer Selection -->
        <div class="col-md-auto form-group mb-3 d-flex align-items-center">
          <label for="customer-dropdown" id="Customer_id">Customer</label>
          <select id="customer-dropdown" class="form-control">
            <!-- Options here -->
          </select>
        </div>

        <div class="col-md-auto form-group mb-3 d-flex align-items-center">
          <label for="calendar-dropdown" id="Calendar_id">Calendar</label>
          <select id="calendar-dropdown" class="form-control">
            <option value="month" selected>month</option>
            <option value="week">week</option>
            <option value="day">day</option>
            <!-- Options here -->
          </select>
        </div>
      </div>
    </div>

    <!-- Testing loading ICON -->
    <div id="loadingIcon" class="loading"></div>

    <div class="calendar-container" id="calendar-containerid">
      <div class="calendar-nav">
        <button onclick="moveMonth(-1)">&lt; </button>
        <span id="monthYear"></span>
        <button onclick="moveMonth(1)"> &gt;</button>
      </div>

      <table id="calendar">
        <thead>
          <tr>
            <th>Sun</th>
            <th>Mon</th>
            <th>Tue</th>
            <th>Wed</th>
            <th>Thu</th>
            <th>Fri</th>
            <th>Sat</th>
          </tr>
        </thead>
        <tbody id="calendar-body">
          <!-- Calendar days will be generated here -->
        </tbody>
      </table>
    </div>

    <!-- Week Calendar -->
    <div class="week-calendar-container" id="week-calendarid">
      <div class="week-calendar-nav">
        <button id="prevWeek" class="week-calendar-button">&lt;</button>
        <span id="WeekMonthYear"></span>
        <button id="nextWeek" class="week-calendar-button">&gt;</button>
      </div>
      <table id="week-calendar">
        <thead>
          <tr id="week-days-header">
            <th>Time</th>
          </tr>
        </thead>
        <tbody id="week-calendar-body"></tbody>
      </table>
    </div>

    <!-- Daily Calendar -->

    <div class="daily-calendar-container" id="daily-calendarID">
      <div class="calendar-nav">
        <button onclick="moveDay(-1)">&lt; </button>
        <span id="dailyCalendarMonth"></span>
        <button onclick="moveDay(1)"> &gt;</button>
      </div>

      <div class="daily-calendar">
        <div id="DateBox">
          <span id="dailyCalendarDay"></span>
        </div>
        <div class="daily-calendar-body" , id="DailyBody"></div>
      </div>
    </div>

    <div id="modal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <p id="Start_End_time"></p>
        <p id="Event_title"></p>
        <p id="modalCarer"></p>
        <p id="modalCustomer"></p>
        <p id="modalScheduleId"></p>
        <div id="modalButtons">
          <button id="editButton">Edit</button>
          <button id="deleteButton">Delete</button>
        </div>
      </div>
    </div>

    <!-- Update pop up window -->
    <div id="editSchedulePopup" class="edit-schedule-popup">
      <div class="popup-content">
        <span class="close-popup">&times;</span>
        <h2>Update record</h2>
        <form id="editScheduleForm">
          <label>Select Carer</label>
          <select id="carer_update"></select>
          <label>Select Customer</label>
          <select id="customer_update"></select>
          <label>Start Time:</label>
          <input
            type="datetime-local"
            id="startTime"
            onchange="validateTime()"
          />
          <label>End Time:</label>
          <input
            type="datetime-local"
            id="endTime"
            onchange="validateTime2()"
          />
          <label>Change Event Type for the Shift:</label>
          <select id="eventType">
            <option value="cleaning">Cleaning</option>
            <option value="Gardening">Gardening</option>
            <option value="nursingService">Nursing Service</option>
            <option value="communityActivities">Community Activities</option>
            <option value="digitalService">Digital Service Support</option>
            <option value="travelAssistance">Travel Assistance</option>
            <option value="careandsupport">In home care and support</option>
            <option value="other">Other</option>
          </select>
          <button id="updateButton" type="button">Save Changes</button>
        </form>
      </div>
    </div>

    <script>
      const airtableBaseId = "app8p4RecoWg7JsOX";
      const airtableTableName = "Users";
      const airtableUrl = "https://api.airtable.com/v0/app8p4RecoWg7JsOX/Users";
      const airtableApiKey =
        "patbjbBB4mGfLvwMD.e257cd19ea5b9b3a5337417837f56d29c6f8b8dfeae4a7853b8da010f990e3df";
      const emailToSearch = "jessie.wu@everyoungai.com";

      const encodedFormulaByEmail = encodeURIComponent(
        `{Email} = '${emailToSearch}'`
      );

      function populateDropdown(dropdownId, data, select) {
        const dropdown = document.getElementById(dropdownId);
        data.forEach((item) => {
          const option = new Option(item, item);
          dropdown.add(option);
        });
      }

      let allRecords = [];
      let offset;

      async function fetchAllRecords(offsetParam) {
        let url = `https://api.airtable.com/v0/${airtableBaseId}/${airtableTableName}?filterByFormula=${encodedFormulaByEmail}`;
        if (offsetParam) {
          url += `&offset=${offsetParam}`;
        }

        try {
          const response = await fetch(url, {
            headers: {
              Authorization: `Bearer ${airtableApiKey}`,
            },
          });
          const data = await response.json();
          allRecords = allRecords.concat(data.records);

          if (data.offset) {
            await fetchAllRecords(data.offset);
          }
        } catch (error) {
          console.error("Error:", error);
        }
      }

      const customerNames = [];
      const carerNames = [];
      let userObject = {
        "Carer Active": ["All"],
        Customer: ["All"],
      };
      let userRecordID = {
        "Carer Active": [],
        Customer: [],
      };

      async function fetchCustomerNames(customerRecordIds, role) {
        await fetchAllRecords();
        //console.log("All the record is" + JSON.stringify(allRecords) );
        const recordId = allRecords[0]["fields"]["Client"];
        const userType = ["Customer", "Carer Active"];

        const fetchPromises = userType.map((type) => {
          const encodedFormula = encodeURIComponent(
            `AND({Record ID (from Client)} = '${recordId}', {User Type} = '${type}')`
          );
          const url = `https://api.airtable.com/v0/${airtableBaseId}/Users?filterByFormula=${encodedFormula}`;
          return fetch(url, {
            headers: { Authorization: `Bearer ${airtableApiKey}` },
          }).then((response) => response.json());
        });

        try {
          const results = await Promise.all(fetchPromises);
          for (let i = 0; i < results.length; i++) {
            for (const record of results[i].records) {
              userObject[userType[i]].push(record.fields.Name);
            }
          }
        } catch (error) {
          console.error("Error:", error);
        }
      }

      let carerRecordID = [];
      async function findCalendar() {
        for (var i = 0; i < userObject["Carer Active"].length; i++) {
          const Casername = userObject["Carer Active"][i];
          const encodedFormulaByCaserId = encodeURIComponent(
            `{Name} = '${Casername}'`
          );
          try {
            const response = await fetch(
              `https://api.airtable.com/v0/${airtableBaseId}/Carers?filterByFormula=${encodedFormulaByCaserId}`,
              {
                headers: {
                  Authorization: `Bearer ${airtableApiKey}`,
                },
              }
            );

            const Caser_Data = await response.json();

            for (const record of Caser_Data.records) {
              carerRecordID.push(record.fields.devRecordId);
            }

            //console.log("Carer ID collection is" + carerRecordID);
          } catch (error) {
            console.error("Error:", error);
          }
        }
      }

      let UserList;
      async function FindCustomer(LINKED_FIELD_NAME, LINKED_RECORD_ID) {
        // Encode the formula for use in a URL query parameter
        const encodedFormula = encodeURIComponent(
          `{${LINKED_FIELD_NAME}} = '${LINKED_RECORD_ID}'`
        );

        const response = await fetch(
          `https://api.airtable.com/v0/${airtableBaseId}/Schedule?filterByFormula=${encodedFormula}`,
          {
            headers: {
              Authorization: `Bearer ${airtableApiKey}`,
            },
          }
        );

        const data = await response.json();
        const User_records = data.records;

        // console.log("data is :" + JSON.stringify(data.records));
        let CustomersAndCarers = User_records.map((record) => {
          const fields = record.fields;

          const Schedule_id = fields["Record ID"] || [];
          const customers = fields.Customers || [];
          const carers = fields.Carers || [];
          const start = fields.Start || [];
          const end = fields.End || [];
          const event = fields.Services || [];

          ////////////////////////////////////////////ADD MORE INFORMATION HERE/////////////////////////////

          return {
            recordId: record.id,
            customers: customers,
            carers: carers,
            start: start,
            end: end,
            event: event,
            schedule_id: Schedule_id,
          };
        });

        UserList = CustomersAndCarers;
        //console.log("THE TEST :" + JSON.stringify(CustomersAndCarers));
        return CustomersAndCarers;
      }

      async function handleAllRecords() {
        await fetchCustomerNames();
        await findCalendar();

        //console.log("The user's OBJECT is " +JSON.stringify(userObject) );

        populateDropdown(
          "customer-dropdown",
          userObject["Customer"],
          "customers"
        );
        populateDropdown(
          "carer-dropdown",
          userObject["Carer Active"],
          "carers"
        );
      }

      async function CollectAllRecord(recordname, colname) {
        function mergeObjectsInArray(arrayOfArrays) {
          return arrayOfArrays.reduce((accumulator, currentArray) => {
            return [...accumulator, ...currentArray];
          }, []);
        }

        let All_Carer = [];
        for (var i = 1; i < userObject[recordname].length; i++) {
          const result = await FindCustomer(colname, userObject[recordname][i]);

          All_Carer.push(result);
        }
        //console.log("THIS IS ALL Customer NUMBER"  + All_Carer.length)
        //console.log("The DAMN result is:" +JSON.stringify(All_Carer));

        return mergeObjectsInArray(All_Carer);
      }

      async function setupEventListeners() {
        await handleAllRecords();

        // const search_button_Carer = document.getElementById("Search_button_Carer");
        const search_button_Carer = document.getElementById("carer-dropdown");
        // const search_button_Customer = document.getElementById("Search_button_Customer");
        const search_button_Customer =
          document.getElementById("customer-dropdown");
        const selectCarer = document.getElementById("carer-dropdown");
        const selectCustomer = document.getElementById("customer-dropdown");

        function updateSpecialDates(newDates) {
          specialDates = newDates;

          update_whole_calendar();

          document.getElementById("loadingIcon").style.display = "none";
        }

        search_button_Carer.addEventListener("change", async function () {
          const carer_options = selectCarer.options;
          const customer_options = selectCustomer.options;

          const selected_carer = selectCarer.selectedOptions[0].value;
          const selected_customer = selectCustomer.selectedOptions[0].value;
          const Carer_Schedule = "";

          //console.log("Carer:" + JSON.stringify(selected_carer));
          //console.log("Customer:" + JSON.stringify(selected_customer));

          if (selected_carer == "All") {
            document.getElementById("loadingIcon").style.display = "block";
            const all_carer = await CollectAllRecord("Carer Active", "Carers");
            //console.log("All the CARER" +JSON.stringify(all_carer) );
            specialDates = await GenerateResult(all_carer);
            //console.log("ALL THE DATE" + specialDates);
            updateSpecialDates(specialDates);
          } else {
            document.getElementById("loadingIcon").style.display = "block";
            const result = await FindCustomer("Carers", selected_carer);
            //console.log("Carer list is :" + JSON.stringify(result));

            specialDates = await GenerateResult(result);

            updateSpecialDates(specialDates);

            //console.log("THE OUTPUT IS" + JSON.stringify(specialDates));
          }
        });

        search_button_Customer.addEventListener("change", async function () {
          const carer_options = selectCarer.options;
          const customer_options = selectCustomer.options;

          const selected_carer = selectCarer.selectedOptions[0].text;
          const selected_customer = selectCustomer.selectedOptions[0].text;
          //console.log("Carer:" + JSON.stringify(selected_carer));
          //console.log("Customer:" + JSON.stringify(selected_customer));
          if (selected_customer == "All") {
            const All_Customer = [];
            // for (var i = 1; i < userObject['Customer'].length;i++){
            document.getElementById("loadingIcon").style.display = "block";
            const all_customer = await CollectAllRecord(
              "Customer",
              "Customers"
            );
            //console.log("All the Customer" +JSON.stringify(all_customer) );
            specialDates = await GenerateResult(all_customer);
            //console.log("ALL THE DATE" + specialDates);
            updateSpecialDates(specialDates);

            // }
          } else {
            document.getElementById("loadingIcon").style.display = "block";

            const result = await FindCustomer("Customers", selected_customer);
            //console.log("Customer list is :" + JSON.stringify(result))

            specialDates = await GenerateResult(result);

            updateSpecialDates(specialDates);

            //console.log("THE OUTPUT IS" + JSON.stringify(specialDates));
          }
        });
        async function GenerateResult(input) {
          let fetchPromises = input.map((item) => {
            const encodedFormulaCustomer = encodeURIComponent(
              `recordid = '${item.customers}'`
            );
            const encodedFormulaCarer = encodeURIComponent(
              `devRecordId = '${item.carers}'`
            );
            const encodedFormulaService = encodeURIComponent(
              `Record_id = '${item.event}'`
            );

            return Promise.all([
              fetch(
                `https://api.airtable.com/v0/${airtableBaseId}/Customers?filterByFormula=${encodedFormulaCustomer}`,
                { headers: { Authorization: `Bearer ${airtableApiKey}` } }
              ),
              fetch(
                `https://api.airtable.com/v0/${airtableBaseId}/Carers?filterByFormula=${encodedFormulaCarer}`,
                { headers: { Authorization: `Bearer ${airtableApiKey}` } }
              ),
              fetch(
                `https://api.airtable.com/v0/${airtableBaseId}/Services?filterByFormula=${encodedFormulaService}`,
                { headers: { Authorization: `Bearer ${airtableApiKey}` } }
              ),
            ]).then(
              async ([customerResponse, carerResponse, serviceResponse]) => {
                const customerData = await customerResponse.json();
                const carerData = await carerResponse.json();
                const serviceData = await serviceResponse.json();

                return {
                  customer: customerData.records[0]?.fields.Customer,
                  carer: carerData.records[0]?.fields.Name,
                  service: serviceData.records[0]?.fields["Service name"],
                  start: item.start,
                  end: item.end,
                  schedule_id: item.recordId,
                };
              }
            );
          });

          try {
            const results = await Promise.all(fetchPromises);

            return results.map((item) => {
              let start_date = new Date(item.start);
              let end_date = new Date(item.end);
              let sydneyStartTime = start_date.toLocaleString("en-AU", {
                timeZone: "Australia/Sydney",
              });
              let sydneyEndTime = end_date.toLocaleString("en-AU", {
                timeZone: "Australia/Sydney",
              });

              let [sydneyStartDate, sydneyStartHour] =
                sydneyStartTime.split(", ");
              let [sydneyEndDate, sydneyEndHour] = sydneyEndTime.split(", ");
              let formattedSydneyStartTime = `${sydneyStartDate.trim()} ${sydneyStartHour.trim()}`;
              let formattedSydneyEndTime = `${sydneyEndDate.trim()} ${sydneyEndHour.trim()}`;

              return {
                customer: item.customer,
                carer: item.carer,
                service: item.service,
                normal_start_date: formattedSydneyStartTime,
                normal_end_date: formattedSydneyEndTime,
                schedule_id: item.schedule_id,
                ios_start_date: start_date,
                ios_end_date: end_date,
              };
            });
          } catch (error) {
            console.error("Error:", error);
            return [];
          }
        }
      }

      let carer_customer_id = {
        carer: {},
        customer: {},
      };
      async function fetchRecord(url, headers) {
        const response = await fetch(url, { headers });
        if (response.ok) {
          return response.json();
        } else {
          throw new Error(
            `Fetch error: ${response.status} ${response.statusText}`
          );
        }
      }

      async function get_carer_customer_record_id() {
        let carerPromises = userObject["Carer Active"].slice(1).map((carer) => {
          const encodedFormula = encodeURIComponent(`{Name} = '${carer}'`);
          const url = `https://api.airtable.com/v0/${airtableBaseId}/Carers?filterByFormula=${encodedFormula}`;
          return fetchRecord(url, { Authorization: `Bearer ${airtableApiKey}` })
            .then((data) => {
              if (data.records && data.records.length > 0) {
                carer_customer_id.carer[carer] =
                  data.records[0].fields.devRecordId;
              } else {
                //console.log(`No records found for Carer: ${carer}`);
              }
            })
            .catch((error) =>
              console.error(`Error fetching Carer: ${carer}`, error)
            );
        });

        let customerPromises = userObject["Customer"]
          .slice(1)
          .map((customer) => {
            const encodedFormula = encodeURIComponent(`{Name} = '${customer}'`);
            const url = `https://api.airtable.com/v0/${airtableBaseId}/Customers?filterByFormula=${encodedFormula}`;
            return fetchRecord(url, {
              Authorization: `Bearer ${airtableApiKey}`,
            })
              .then((data) => {
                if (data.records && data.records.length > 0) {
                  carer_customer_id.customer[customer] =
                    data.records[0].fields.recordid;
                } else {
                  //console.log(`No records found for Customer: ${customer}`);
                }
              })
              .catch((error) =>
                console.error(`Error fetching Customer: ${customer}`, error)
              );
          });

        await Promise.all([...carerPromises, ...customerPromises]);
        //console.log("The response data is: ", carer_customer_id);
      }

      async function OriginalDeploy() {
        document.getElementById("loadingIcon").style.display = "block";

        const all_carer = await CollectAllRecord("Customer", "Customers");

        await get_carer_customer_record_id();
        specialDates = await GenerateResult(all_carer);
        //console.log("Original Special dates IS " +JSON.stringify(specialDates) );

        async function GenerateResult(input) {
          let output = [];
          let fetchPromises = [];

          for (let i = 0; i < input.length; i++) {
            const encodedFormulaCustomer = encodeURIComponent(
              `recordid = '${input[i].customers}'`
            );
            const encodedFormulaCarer = encodeURIComponent(
              `devRecordId = '${input[i].carers}'`
            );
            const encodedFormulaService = encodeURIComponent(
              `Record_id = '${input[i].event}'`
            );

            fetchPromises.push(
              Promise.all([
                fetch(
                  `https://api.airtable.com/v0/${airtableBaseId}/Customers?filterByFormula=${encodedFormulaCustomer}`,
                  { headers: { Authorization: `Bearer ${airtableApiKey}` } }
                ),
                fetch(
                  `https://api.airtable.com/v0/${airtableBaseId}/Carers?filterByFormula=${encodedFormulaCarer}`,
                  { headers: { Authorization: `Bearer ${airtableApiKey}` } }
                ),
                fetch(
                  `https://api.airtable.com/v0/${airtableBaseId}/Services?filterByFormula=${encodedFormulaService}`,
                  { headers: { Authorization: `Bearer ${airtableApiKey}` } }
                ),
              ])
                .then(
                  async ([
                    customerResponse,
                    carerResponse,
                    serviceResponse,
                  ]) => {
                    const customerData = await customerResponse.json();
                    const carerData = await carerResponse.json();
                    const serviceData = await serviceResponse.json();

                    return {
                      customer:
                        customerData.records.length > 0
                          ? customerData.records[0].fields.Customer
                          : "",
                      carer:
                        carerData.records.length > 0
                          ? carerData.records[0].fields.Name
                          : "",
                      service:
                        serviceData.records.length > 0
                          ? serviceData.records[0].fields["Service name"]
                          : "",
                      start: input[i].start,
                      end: input[i].end,
                      schedule_id: input[i].recordId,
                      carer_id: input[i].carers,
                      customer_id: input[i].customers,
                    };
                  }
                )
                .catch((error) => {
                  console.error("Error:", error);
                })
            );
          }

          try {
            const results = await Promise.all(fetchPromises);

            for (const result of results) {
              if (result) {
                let start_date = new Date(result.start);
                let end_date = new Date(result.end);
                let sydneyStartTime = start_date.toLocaleString("en-AU", {
                  timeZone: "Australia/Sydney",
                });
                let sydneyEndTime = end_date.toLocaleString("en-AU", {
                  timeZone: "Australia/Sydney",
                });

                let [sydneyStartDate, sydneyStartHour] =
                  sydneyStartTime.split(", ");
                let [sydneyEndDate, sydneyEndHour] = sydneyEndTime.split(", ");
                let formattedSydneyStartTime = `${sydneyStartDate.trim()} ${sydneyStartHour.trim()}`;
                let formattedSydneyEndTime = `${sydneyEndDate.trim()} ${sydneyEndHour.trim()}`;

                output.push({
                  customer: result.customer,
                  carer: result.carer,
                  service: result.service,
                  normal_start_date: formattedSydneyStartTime,
                  normal_end_date: formattedSydneyEndTime,
                  schedule_id: result.schedule_id,
                  ios_start_date: start_date,
                  ios_end_date: end_date,
                  carer_id: result.carer_id,
                  customer_id: result.customer_id,
                });
              }
            }

            return output;
          } catch (error) {
            console.error("Error:", error);
          }
        }
      }

      function deploy_carer_customer() {
        var carerUpdateSelect = document.getElementById("carer_update");
        var customerUpdateSelect = document.getElementById("customer_update");
        var carerOptions = userObject["Carer Active"];
        var customerOptions = userObject["Customer"];

        carerUpdateSelect.innerHTML = "";
        customerUpdateSelect.innerHTML = "";

        carerOptions.slice(1).forEach(function (item) {
          let optionElement = document.createElement("option");
          optionElement.value = item;
          optionElement.textContent = item;
          carerUpdateSelect.appendChild(optionElement);
        });

        customerOptions.slice(1).forEach(function (item) {
          let optionElement = document.createElement("option");
          optionElement.value = item;
          optionElement.textContent = item;
          customerUpdateSelect.appendChild(optionElement);
        });
      }
      async function switchCalendar() {
        document
          .getElementById("calendar-dropdown")
          .addEventListener("change", function () {
            var monthCalendar = document.getElementById("calendar-containerid");
            var weekCalendar = document.getElementById("week-calendarid");
            var dayCalendar = document.getElementById("daily-calendarID");

            if (this.value === "month") {
              dayCalendar.style.display = "none";
              monthCalendar.style.display = "block";
              weekCalendar.style.display = "none";
            } else if (this.value === "week") {
              dayCalendar.style.display = "none";
              monthCalendar.style.display = "none";
              weekCalendar.style.display = "block";
            } else if (this.value === "day") {
              dayCalendar.style.display = "block";
              monthCalendar.style.display = "none";
              weekCalendar.style.display = "none";
            }
          });
      }

      async function FinalDeploy() {
        await switchCalendar();
        await setupEventListeners();
        await OriginalDeploy();
        setupNavigationButtons();
        //console.log("The user object is" + JSON.stringify(userObject))

        update_whole_calendar();
      }
      FinalDeploy();

      /////////////////////////////////////////SEPARATE LINE FOR CANLENDER/////////////////////////////////////////////
      let currentYear = new Date().getFullYear();
      let currentMonth = new Date().getMonth();

      /*Method*/
      let specialDates = [];

      let currentBaseDate = new Date();

      function setupWeekCalendar(specialDate) {
        currentBaseDate = new Date();
        currentBaseDate.setDate(
          currentBaseDate.getDate() - currentBaseDate.getDay()
        );

        createWeekCalendar(currentBaseDate, specialDate);

        // setupNavigationButtons();
      }

      function createWeekCalendar(baseDate, specialDate) {
        const weekCalendarBody = document.getElementById("week-calendar-body");
        const weekDaysHeader = document.getElementById("week-days-header");
        const WeekMonthYear = document.getElementById("WeekMonthYear");
        
        weekCalendarBody.innerHTML = "";
        weekDaysHeader.innerHTML = "<th>Time</th>";

        const currentYear = baseDate.getFullYear();

        //console.log("The week special date is" + JSON.stringify(specialDate) );
        const curMonthDisplay = baseDate.toLocaleString("en-AU", {
          year: "numeric",
          month: "long",
          timeZone: "Australia/Sydney",
        }).split(",")[0];

        WeekMonthYear.textContent = curMonthDisplay;

        for (let i = 0; i < 7; i++) {
          let dayDate = new Date(baseDate);
          dayDate.setDate(baseDate.getDate() + i);
          let dayHeader = document.createElement("th");
          dayHeader.textContent = dayDate.toLocaleString("default", {
            weekday: "short",
            day:"2-digit",
          });
          weekDaysHeader.appendChild(dayHeader);
        }

        for (let hour = 6; hour < 22; hour++) {
          let row = document.createElement("tr");
          row.classList.add("row-cell");

          let timeLabel = document.createElement("td");
          timeLabel.textContent = formatHour(hour);
          row.appendChild(timeLabel);

          for (let day = 0; day < 7; day++) {
            let cell = document.createElement("td");
            let text_space = document.createElement("div");
            cell.classList.add("custom-cell");
            text_space.classList.add("text-cell");
            cell.appendChild(text_space);

            let cellDate = new Date(baseDate);
            cellDate.setDate(baseDate.getDate() + day);
            addEventsToCell(text_space, cellDate, hour, specialDate);
            row.appendChild(cell);
          }

          weekCalendarBody.appendChild(row);
        }
      }

      function addEventsToCell(cell, cellDate, hour, specialDate) {
        let colors = ["red", "blue", "green", "orange", "purple", "yellow"];
        let colorIndex = 0;
        let events = specialDate.filter((event) => {
          let startDate = new Date(event.ios_start_date);
          // console.log(`startDate: ${startDate}, cellDate: ${cellDate}, hour: ${hour}`);
          //  console.log(`Date comparison: ${startDate.getDate() === cellDate.getDate() && startDate.getMonth() === cellDate.getMonth() && startDate.getFullYear() === cellDate.getFullYear() && startDate.getHours() === hour}`);
          return (
            startDate.getDate() === cellDate.getDate() &&
            startDate.getMonth() === cellDate.getMonth() &&
            startDate.getFullYear() === cellDate.getFullYear() &&
            startDate.getHours() === hour
          );
        });
        console.log("THE events is " + JSON.stringify(events));
        events.forEach((event) => {
          console.log("THE week event is" + JSON.stringify(event));
          let eventElement = document.createElement("div");
          eventElement.classList.add("event-tip");
          let bullet = document.createElement("span");
          bullet.textContent = "• ";
          bullet.style.color = colors[colorIndex];
          eventElement.appendChild(bullet);
          let startIndex = event.normal_start_date.length - 11;
          let textNode = document.createTextNode(
            event.normal_start_date.substring(startIndex) + " " + event.service
          );
          eventElement.appendChild(textNode);
          colorIndex = (colorIndex + 1) % colors.length;
          eventElement.onclick = function () {
            showModal(event);
          };
          cell.appendChild(eventElement);
        });
      }

      function formatHour(hour) {
        const ampm = hour >= 12 ? "PM" : "AM";
        hour = hour % 12;
        hour = hour ? hour : 12;
        return `${hour}:00 ${ampm}`;
      }

      function setupNavigationButtons() {
        document
          .getElementById("prevWeek")
          .addEventListener("click", function () {
            adjustWeek(-7);

            // console.log("THe week special Dates is" +JSON.stringify(specialDates) );
          });

        document
          .getElementById("nextWeek")
          .addEventListener("click", function () {
            adjustWeek(7);

            // console.log("THe week special Dates is" +JSON.stringify(specialDates) );
          });
      }

      function adjustWeek(days) {
        currentBaseDate.setDate(currentBaseDate.getDate() + days);
        createWeekCalendar(currentBaseDate, specialDates);
        console.log(JSON.stringify(currentBaseDate.getDate()));
      }

      function update_whole_calendar() {
        createCalendar(currentYear, currentMonth, specialDates);
        setupWeekCalendar(specialDates);
        createDailyCal(curDay, specialDates);
      }

      function createCalendar(year, month, specialDates) {
        let monthYear = document.getElementById("monthYear");
        let calendarBody = document.getElementById("calendar-body");
        let firstDay = new Date(year, month).getDay();
        let daysInMonth = new Date(year, month + 1, 0).getDate();

        monthYear.textContent = `${new Date(year, month).toLocaleString(
          "default",
          { month: "long" }
        )} ${year}`;
        calendarBody.innerHTML = "";

        let date = 1;
        for (let i = 0; i < 6; i++) {
          let row = document.createElement("tr");

          for (let j = 0; j < 7; j++) {
            let cell = document.createElement("td");

            if (i === 0 && j < firstDay) {
              cell.innerHTML = "";
              row.appendChild(cell);
            } else if (date > daysInMonth) {
              break;
            } else {
              let cellDate = new Date(year, month, date);
              let formattedDate = `${cellDate.getFullYear()}-${String(
                cellDate.getMonth() + 1
              ).padStart(2, "0")}-${String(cellDate.getDate()).padStart(
                2,
                "0"
              )}`;

              let daysEvents = specialDates.filter((d) => {
                let eventStartDate = new Date(d.ios_start_date);
                let eventFormattedDate = `${eventStartDate.getFullYear()}-${String(
                  eventStartDate.getMonth() + 1
                ).padStart(2, "0")}-${String(eventStartDate.getDate()).padStart(
                  2,
                  "0"
                )}`;

                return formattedDate === eventFormattedDate;
              });

              daysEvents.sort((a, b) => a.ios_start_date - b.ios_end_date);
              let colors = [
                "red",
                "blue",
                "green",
                "orange",
                "purple",
                "yellow",
              ];
              let eventsList = document.createElement("ul");
              daysEvents.forEach((event, index) => {
                let eventItem = document.createElement("li");

                let eventStartDate = new Date(event.ios_start_date);
                let sydneyTime = eventStartDate.toLocaleString("en-AU", {
                  timeZone: "Australia/Sydney",
                  hour: "2-digit",
                  minute: "2-digit",
                  timeZoneName: "short",
                });
                let sydneyshowTime = sydneyTime.slice(0, -4);
                eventItem.textContent = `${sydneyshowTime} ${event.service}`;

                eventItem.className = `color-${index % colors.length}`;

                eventItem.onclick = function () {
                  //console.log("THE EVENT IS " +JSON.stringify(event) );
                  showModal(event);
                };
                eventsList.appendChild(eventItem);
              });

              cell.innerHTML = date;
              cell.appendChild(eventsList);
              row.appendChild(cell);
              date++;
            }
          }
          calendarBody.appendChild(row);
        }

        document.getElementById("loadingIcon").style.display = "none";
      }

      async function showModal(event) {
        deploy_carer_customer();
        function updateSpecialDates(newDates) {
          specialDates = newDates;

          update_whole_calendar();
          document.getElementById("loadingIcon").style.display = "none";
        }

        let modal = document.getElementById("modal");
        document.getElementById(
          "Start_End_time"
        ).textContent = `${event.normal_start_date} - ${event.normal_end_date}`;
        document.getElementById(
          "Event_title"
        ).textContent = `Event: ${event.service}`;
        document.getElementById(
          "modalCarer"
        ).textContent = `Carer: ${event.carer}`;
        document.getElementById(
          "modalCustomer"
        ).textContent = `Customer: ${event.customer}`;
        // document.getElementById('modalScheduleId').textContent = `Schedule ID: ${event.schedule_id}`;

        let editButton = document.getElementById("editButton");
        let deleteButton = document.getElementById("deleteButton");
        let updateButton = document.getElementById("updateButton");

        var editSchedulePopup = document.getElementById("editSchedulePopup");

        var closePopup = document.getElementsByClassName("close-popup")[0];

        editButton.onclick = function () {
          closeModal();
          editSchedulePopup.style.display = "block";
          //console.log('edit schedule id:', event.schedule_id);
        };

        updateButton.onclick = async function () {
          let service_record = {
            cleaning: "recJK03v5iM0g1yaK",
            Gardening: "rechGWOft0o3jljpp",
            nursingService: "recwoXYVxAQkikJB5",
            communityActivities: "rec4fGWFKd6ATfzzI",
            digitalService: "recNEpgqDQArZhZtR",
            travelAssistance: "reco5fVaOImm9sdvw",
            careandsupport: "recZMc5BenaLN7fE5",
            other: "",
          };

          var carerSelect = document.getElementById("carer_update");
          var selectedCarerText =
            carerSelect.options[carerSelect.selectedIndex].text;
          var customerSelect = document.getElementById("customer_update");
          var selectedCustomerText =
            customerSelect.options[customerSelect.selectedIndex].text;
          var selectCarerId = carer_customer_id.carer[selectedCarerText];
          var selectCustomerId =
            carer_customer_id.customer[selectedCustomerText];

          var startTime = document.getElementById("startTime").value;
          var startTime2 = new Date(startTime);
          var startTime3 = startTime2.toISOString();

          var endTime = document.getElementById("endTime").value;
          var endTime2 = new Date(endTime);
          var endTime3 = endTime2.toISOString();

          var eventType = document.getElementById("eventType").value;

          var formattedStartTime = formatDateTime(startTime);
          var formattedEndTime = formatDateTime(endTime);
          //console.log("THE unformateed start time is" + startTime);
          //console.log("THE formatted start time is" + formattedStartTime);

          var startDateTime = new Date(formattedStartTime);
          var endDateTime = new Date(formattedEndTime);
          var newService = [];
          newService.push(service_record[eventType]);

          var data = {
            fields: {
              Start: startDateTime.toISOString(),
              End: endDateTime.toISOString(),
              Services: newService,
              Customers: [selectCustomerId],
              Carers: [selectCarerId],
            },
          };
          var data_to_update = {
            Start: startTime3,
            End: endTime3,
            Services: eventType,
            Customers: selectedCustomerText,
            Carers: selectedCarerText,
          };

          //console.log(`The carer id is ${selectCarerId} and customer id is ${selectCustomerId}`)

          await updateConfirm(
            event,
            data,
            eventType,
            formattedStartTime,
            formattedEndTime,
            data_to_update
          );

          //console.log("The UPDATING specialDates is" + JSON.stringify(specialDates) );

          updateSpecialDates(specialDates);
        };

        function formatDateTime(dateTime) {
          var date = new Date(dateTime);
          return date.toLocaleDateString() + " " + date.toLocaleTimeString();
        }

        deleteButton.onclick = async function () {
          await deleteConfirm(event);

          updateSpecialDates(specialDates);

          closeModal();
        };

        closePopup.onclick = window.onclick = function (event) {
          if (
            event.target === closePopup ||
            event.target === editSchedulePopup
          ) {
            editSchedulePopup.style.display = "none";
          }
        };

        modal.style.display = "block";
      }

      async function deleteConfirm(event) {
        //console.log("THE not updated special date is " + JSON.stringify(specialDates));
        let confirmation = confirm("Are you sure to delete this schedule?");
        if (confirmation) {
          deleteRecord("Schedule", event.schedule_id);
          specialDates = specialDates.filter(
            (item) => item.schedule_id !== event.schedule_id
          );
        }
        //console.log("THE updated special date is " + JSON.stringify(specialDates));
      }

      async function updateConfirm(
        event,
        data,
        service,
        start_time,
        end_time,
        data_to_update
      ) {
        let confirmation = confirm("Are you sure to update this schedule?");
        if (confirmation) {
          await updateRecord("Schedule", event.schedule_id, data);

          let scheduleToUpdate = specialDates.find(
            (item) => item.schedule_id === event.schedule_id
          );

          let iosStartDateObject = new Date();
          let iosEndDateObject = new Date();
          if (scheduleToUpdate) {
            try {
              scheduleToUpdate.customer = data_to_update.Customers;
              scheduleToUpdate.carer = data_to_update.Carers;
              scheduleToUpdate.normal_start_date = start_time;
              scheduleToUpdate.normal_end_date = end_time;
              // scheduleToUpdate.ios_start_date = transfer_iostime(start_time);
              // scheduleToUpdate.ios_end_date = transfer_iostime(end_time);

              scheduleToUpdate.ios_start_date = new Date(data_to_update.Start);
              scheduleToUpdate.ios_end_date = new Date(data_to_update.End);

              scheduleToUpdate.service = service;
            } catch (error) {
              console.error("Error updating schedule:", error);
            }
          }
        }
      }

      function transfer_iostime(normal_time) {
        let match = normal_time.match(
          /(\d{1,2})\/(\d{1,2})\/(\d{4}) (\d{1,2}):(\d{2}):(\d{2}) (am|pm)/i
        );
        if (!match) {
          throw new Error("Invalid time format");
        }

        let hour = parseInt(match[4], 10);
        if (match[7].toLowerCase() === "pm" && hour < 12) {
          hour += 12;
        } else if (match[7].toLowerCase() === "am" && hour === 12) {
          hour = 0;
        }

        let sydneyDate = new Date(
          `${match[3]}-${match[1].padStart(2, "0")}-${match[2].padStart(
            2,
            "0"
          )}T${hour.toString().padStart(2, "0")}:${match[5]}:${match[6]}`
        );

        let timezoneOffsetInHours = 10;
        sydneyDate.setHours(sydneyDate.getHours() - timezoneOffsetInHours);
        //console.log("THE TRANSFOR IOS TIME IS " + sydneyDate);

        return sydneyDate;
      }

      function closeModal() {
        let modal = document.getElementById("modal");
        modal.style.display = "none";
      }

      window.onclick = function (event) {
        let modal = document.getElementById("modal");
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };

      function moveMonth(step) {
        currentMonth += step;
        if (currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        } else if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
        update_whole_calendar();
      }

      async function updateRecord(tableName, recordId, data) {
        fetch(
          `https://api.airtable.com/v0/${airtableBaseId}/${tableName}/${recordId}`,
          {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
              Authorization: "Bearer " + airtableApiKey,
            },
            body: JSON.stringify(data),
          }
        )
          .then((response) => response.json())
          .then((data) => {
            //console.log(data);
            alert("Schedule updated successfully.");
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      } //test the code of update record, it will send the request to airtable and

      function deleteRecord(tableName, recordId) {
        const deleteUrl = `https://api.airtable.com/v0/${airtableBaseId}/${tableName}/${recordId}`;

        fetch(deleteUrl, {
          method: "DELETE",
          headers: {
            Authorization: `Bearer ${airtableApiKey}`,
          },
        })
          .then((response) => response.json())
          .then((data) => {
            //console.log("The data delete"+data);
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }

      //////////////////////////////////////////// Daily Calender ////////////////////////////////////////////////

      let curDay = new Date();

      function createDailyTimeLine() {
        const scheduleContainerElement = document.getElementById("DailyBody");

        const startTime = 6;
        const endTime = 21;

        //create time column
        for (let hour = startTime; hour <= endTime; hour++) {

          let time;
          if (hour === 12) {
            time = `${hour} pm`;
          }else{
            time = `${hour}` > 12 ? `${hour -12} pm`: `${hour} am`;
          }

          const timeElement = document.createElement("div");
          timeElement.className = `time start-${hour}`;
          timeElement.textContent = time;
          timeElement.style.setProperty("grid-area", `time${hour}`);
          scheduleContainerElement.appendChild(timeElement);
        }
      }

      createDailyTimeLine();

      function createDailyEvent(Day, specialDates) {
        const scheduleContainerElement = document.getElementById("DailyBody");

        const curDayDisplay = Day.toLocaleString("en-AU", {
          weekday: "long",
          timeZone: "Australia/Sydney",
        }).split(",")[0];

        const curMonthDisplay = Day.toLocaleString("en-AU", {
          year: "numeric",
          month: "long",
          day: "2-digit",
          timeZone: "Australia/Sydney",
        }).split(",")[0];

        const curDayString = Day.toLocaleString("en-AU", {
          timeZone: "Australia/Sydney",
        }).split(",")[0];

        const DateDisplay = document.getElementById("dailyCalendarDay");
        DateDisplay.textContent = curDayDisplay;
        const MonthDisplay = document.getElementById("dailyCalendarMonth");
        MonthDisplay.textContent = curMonthDisplay;

        let daysEvents = specialDates.filter((d) => {
          const eventday = d.ios_start_date
            .toLocaleString("en-AU", { timeZone: "Australia/Sydney" })
            .split(",")[0];

          return curDayString === eventday;
        });

        //console.log(daysEvents);

        daysEvents.forEach((event, index) => {
          let eventElement = document.createElement("div");

          // ${event.service}

          const sHour = event.ios_start_date.getHours();
          const sMin = event.ios_start_date.getMinutes();
          const eHour = event.ios_end_date.getHours();
          const eMin = event.ios_end_date.getMinutes();
          let eTime = "";

          if (eHour === 21) {
            eTime = `${eHour}`;
          } else {
            eTime = `${eHour + 1}`;
          }

          let sDisplay;
          if (sHour === 12) {
            sDisplay = `${sHour}:${sMin
            .toString()
            .padStart(2, "0")} pm` ;
          }else{
            sDisplay = `${sHour}` > 12 ? `${sHour - 12}:${sMin
            .toString()
            .padStart(2, "0")} pm`: `${sHour}:${sMin
            .toString()
            .padStart(2, "0")} am`;
          }

          let eDisplay;
          if (eHour === 12) {
            eDisplay = `${eHour}:${eMin
            .toString()
            .padStart(2, "0")} pm` ;
          }else{
            eDisplay = `${eHour}` > 12 ? `${eHour - 12}:${eMin
            .toString()
            .padStart(2, "0")} pm`: `${eHour}:${eMin
            .toString()
            .padStart(2, "0")} am`;
          }

          eventElement.className = `dailyevent color-${
            index % 6
          } start-${sHour} end-${eTime}`;
          eventElement.textContent = `${sDisplay} - ${eDisplay}`;

          const eventItemList = [event.service, event.customer, event.carer]
            .map((c) => {
              const elem = document.createElement("p");
              elem.textContent = c;
              return elem;
            })
            .forEach((elem) => eventElement.appendChild(elem));

          eventElement.onclick = function () {
            showModal(event);
          };
          scheduleContainerElement.appendChild(eventElement);
        });
      }

      function deleteDailyEvent() {
        const deleteItem = document.querySelectorAll("div.dailyevent");
        deleteItem.forEach((element) => {
          element.parentNode.removeChild(element);
        });
      }

      async function createDailyCal(Day, specialDates) {
        await deleteDailyEvent();
        // FindEvent();
        createDailyEvent(Day, specialDates);
      }

      function moveDay(step) {
        curDay.setDate(curDay.getDate() + step);

        createDailyCal(curDay, specialDates);
      }

      function validateTime() {
        var input = document.getElementById("startTime");

        var value = input.value;

        var date = new Date(value);

        var StartDate = value.split("T")[0];

        var EndDate = document.getElementById("endTime").value.split("T")[0];

        if (StartDate !== EndDate && EndDate && value) {
          alert("Schedule should be in the same date");
          input.value = "";
          return;
        }

        var hours = date.getHours();
        var minutes = date.getMinutes();
        var valid = hours >= 6 && hours < 21;

        if (!valid && value) {
          alert("Start time must between 6:00 am to 8:59 pm！");
          input.value = "";
        }
      }

      function validateTime2() {
        var StartDate = document
          .getElementById("startTime")
          .value.split("T")[0];

        var input = document.getElementById("endTime");

        var value = input.value;

        if (!StartDate) {
          alert("Please select start time first");
          input.value = "";
          return;
        }

        var date = new Date(value);

        var EndDate = value.split("T")[0];

        if (StartDate !== EndDate && value) {
          alert("Schedule should be in the same date");
          input.value = "";
          return;
        }

        var hours = date.getHours();
        var minutes = date.getMinutes();
        var valid =
          (hours === 21 && minutes === 0) || (hours > 6 && hours < 21);

        if (!valid && value) {
          alert("End time must between 6:01 am to 9:00 pm！");
          input.value = "";
        }
      }
    </script>
  </body>
</html>
